# Veins æ—¥å¿—ç›‘æ§æœåŠ¡å™¨

## åŠŸèƒ½ç‰¹æ€§

- ğŸš€ **å®æ—¶æ—¥å¿—ç›‘æ§**: è‡ªåŠ¨è¯»å–å’Œè§£æ Veins V2X ç½‘ç»œæ—¥å¿—
- ğŸ“Š **å¤šç±»å‹æ”¯æŒ**: æ”¯æŒ Veinsã€CAã€QCAã€é…ç½®æ–‡ä»¶ç­‰å¤šç§æ—¥å¿—ç±»å‹
- ğŸŒ **WebSocket å®æ—¶é€šä¿¡**: å®æ—¶æ¨é€æ–°æ—¥å¿—åˆ°å‰ç«¯
- ğŸ” **é«˜çº§æœç´¢è¿‡æ»¤**: æ”¯æŒæŒ‰çº§åˆ«ã€èŠ‚ç‚¹ã€æ—¶é—´ç­‰å¤šç»´åº¦è¿‡æ»¤
- ğŸ“ˆ **ç»Ÿè®¡åˆ†æ**: æä¾›è¯¦ç»†çš„æ—¥å¿—ç»Ÿè®¡ä¿¡æ¯
- ğŸ” **å®‰å…¨é˜²æŠ¤**: å†…ç½®å®‰å…¨ä¸­é—´ä»¶å’Œè¯·æ±‚é™åˆ¶
- ğŸ“¤ **æ•°æ®å¯¼å‡º**: æ”¯æŒ JSON å’Œ CSV æ ¼å¼å¯¼å‡º

## ç³»ç»Ÿè¦æ±‚

- Node.js 16.0.0 æˆ–æ›´é«˜ç‰ˆæœ¬
- NPM 8.0.0 æˆ–æ›´é«˜ç‰ˆæœ¬
- Windows 10+ æˆ– Linux
- è‡³å°‘ 1GB å¯ç”¨å†…å­˜

## å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
cd server
npm install
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

å¤åˆ¶ `.env.example` åˆ° `.env` å¹¶æ ¹æ®éœ€è¦ä¿®æ”¹é…ç½®ï¼š

```bash
cp .env.example .env
```

### 3. å¯åŠ¨æœåŠ¡å™¨

**å¼€å‘æ¨¡å¼:**
```bash
npm run dev
```

**ç”Ÿäº§æ¨¡å¼:**
```bash
npm start
```

**ä½¿ç”¨ PM2 (æ¨èç”Ÿäº§ç¯å¢ƒ):**
```bash
npm run pm2:start
```

### 4. éªŒè¯æœåŠ¡

è®¿é—® http://localhost:5000/api/health æ£€æŸ¥æœåŠ¡çŠ¶æ€

## API æ–‡æ¡£

### è·å–æ—¥å¿—

```http
GET /api/logs/:type?
```

**å‚æ•°:**
- `type`: æ—¥å¿—ç±»å‹ (all, veins, ca, qca, config)
- `limit`: é™åˆ¶è¿”å›æ•°é‡ (é»˜è®¤: 1000)
- `offset`: åç§»é‡ (é»˜è®¤: 0)
- `level`: æ—¥å¿—çº§åˆ«è¿‡æ»¤
- `search`: æœç´¢å…³é”®è¯
- `nodeId`: èŠ‚ç‚¹IDè¿‡æ»¤

**ç¤ºä¾‹:**
```bash
curl "http://localhost:5000/api/logs/veins?limit=50&level=ERROR"
```

### è·å–ç»Ÿè®¡ä¿¡æ¯

```http
GET /api/logs/stats/:type?
```

### é«˜çº§æœç´¢

```http
POST /api/logs/search
Content-Type: application/json

{
  "query": "vehicle",
  "logType": "veins",
  "filters": {
    "level": "INFO",
    "startTime": "2024-01-01T00:00:00Z"
  }
}
```

## WebSocket äº‹ä»¶

### å®¢æˆ·ç«¯å‘é€

- `subscribe_logs`: è®¢é˜…æ—¥å¿—æ›´æ–°
- `unsubscribe_logs`: å–æ¶ˆè®¢é˜…
- `request_logs`: è¯·æ±‚å®æ—¶æ—¥å¿—
- `ping`: ä¿æ´»æ£€æµ‹

### æœåŠ¡å™¨å‘é€

- `connection_established`: è¿æ¥å»ºç«‹
- `new_logs`: æ–°æ—¥å¿—æ¨é€
- `logs_data`: æ—¥å¿—æ•°æ®å“åº”
- `pong`: ä¿æ´»å“åº”

## ç›®å½•ç»“æ„

```
server/
â”œâ”€â”€ server.js              # ä¸»æœåŠ¡å™¨æ–‡ä»¶
â”œâ”€â”€ logReader.js           # æ—¥å¿—è¯»å–å™¨
â”œâ”€â”€ routes/
â”‚   â””â”€â”€ logs.js            # æ—¥å¿— API è·¯ç”±
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ create-directories.js  # ç›®å½•åˆ›å»ºè„šæœ¬
â”œâ”€â”€ logs/                  # æœåŠ¡å™¨æ—¥å¿—ç›®å½•
â”œâ”€â”€ package.json           # ä¾èµ–é…ç½®
â”œâ”€â”€ ecosystem.config.js    # PM2 é…ç½®
â””â”€â”€ .env                   # ç¯å¢ƒå˜é‡
```

## ç”Ÿäº§éƒ¨ç½²

### ä½¿ç”¨ PM2

```bash
# å®‰è£… PM2
npm install -g pm2

# å¯åŠ¨åº”ç”¨
npm run pm2:start

# æŸ¥çœ‹çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
npm run pm2:logs

# é‡å¯åº”ç”¨
npm run pm2:restart

# åœæ­¢åº”ç”¨
npm run pm2:stop
```

### ä½¿ç”¨ Docker

```dockerfile
FROM node:16-alpine

WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production

COPY . .
EXPOSE 5000

CMD ["npm", "start"]
```

## æ•…éšœæ’é™¤

### 1. ç«¯å£å·²è¢«å ç”¨

```bash
# æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
netstat -ano | findstr :5000

# ç»ˆæ­¢è¿›ç¨‹
taskkill /PID <è¿›ç¨‹ID> /F
```

### 2. æ—¥å¿—æ–‡ä»¶è¯»å–å¤±è´¥

- æ£€æŸ¥æ—¥å¿—æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®
- ç¡®ä¿æœ‰è¶³å¤Ÿçš„æ–‡ä»¶è¯»å–æƒé™
- éªŒè¯ Veins ä»¿çœŸæ˜¯å¦æ­£åœ¨è¿è¡Œ

### 3. WebSocket è¿æ¥å¤±è´¥

- æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
- éªŒè¯ CORS é…ç½®
- ç¡®ä¿ç«¯å£æœªè¢«é˜»æ­¢

## å¼€å‘æŒ‡å—

### æ·»åŠ æ–°çš„æ—¥å¿—è§£æå™¨

1. åœ¨ `logReader.js` ä¸­æ·»åŠ è§£æå‡½æ•°
2. æ›´æ–° `LOG_PARSERS` æ˜ å°„
3. åœ¨ `.env` ä¸­é…ç½®æ–°çš„æ—¥å¿—è·¯å¾„

### æ‰©å±• API ç«¯ç‚¹

1. åœ¨ `routes/logs.js` ä¸­æ·»åŠ æ–°è·¯ç”±
2. å®ç°ç›¸åº”çš„å¤„ç†é€»è¾‘
3. æ›´æ–° API æ–‡æ¡£

## è®¸å¯è¯

MIT License